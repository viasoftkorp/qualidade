<vs-dialog>
  <vs-label title label="Rnc.Navigation.NaoConformidades"></vs-label>
  <vs-icon icon icon="fragile"></vs-icon>

  <div content>
    <vs-form *ngIf="loaded">
      <form [formGroup]="form">
        <div class="field-container w-1/1">
          <vs-input
            [formControlName]="formControls.codigo"
            readonly
            placeholder="NaoConformidades.NaoConformidadesEditor.Codigo"
            class="w-1/8"
          >
          </vs-input>

          <vs-select
            [formControlName]="formControls.status"
            placeholder="NaoConformidades.NaoConformidadesEditor.Status"
            [options]="statusOptions"
            class="w-1/8 margin-left-6"
          ></vs-select>

          <vs-select
            [formControlName]="formControls.origem"
            placeholder="NaoConformidades.NaoConformidadesEditor.Origem"
            [options]="origemOptions"
            required
            class="w-2/8"
          ></vs-select>

          <rnc-notas-fiscais-entrada-autocomplete-select
            *ngIf="origem === origemNaoConformidadesEnum.InspecaoEntrada"
            [disabled]="!hasFornecedor"
            [required]="true"
            [formControlName]="formControls.idNotaFiscal"
            placeholder="NaoConformidades.NaoConformidadesEditor.NotaFiscal"
            [idFornecedor]="idPessoa"
            class="w-2/8"
          ></rnc-notas-fiscais-entrada-autocomplete-select>

          <rnc-notas-fiscais-saida-autocomplete-select
            *ngIf="origem !== origemNaoConformidadesEnum.InspecaoEntrada"
            [formControlName]="formControls.idNotaFiscal"
            placeholder="NaoConformidades.NaoConformidadesEditor.NotaFiscal"
            [idCliente]="idPessoa"
            class="w-2/8"
          ></rnc-notas-fiscais-saida-autocomplete-select>

          <qa-natureza-autocomplete-select
            [formControlName]="formControls.idNatureza"
            [required]="true"
            placeholder="NaoConformidades.NaoConformidadesEditor.Natureza"
            class="w-2/8"
          ></qa-natureza-autocomplete-select>
        </div>

        <div class="field-container w-1/1">
          <person-person-autocomplete-single
            *ngIf="origem !== origemNaoConformidadesEnum.InspecaoEntrada"
            [required]="origem == origemNaoConformidadesEnum.Cliente"
            [formControlName]="formControls.idPessoa"
            placeholder="NaoConformidades.NaoConformidadesEditor.Cliente"
            personType="Customer"
            (changedEvent)="pessoaAlterada($event)"
            class="w-1/4"
          ></person-person-autocomplete-single>

          <person-person-autocomplete-single
            *ngIf="origem === origemNaoConformidadesEnum.InspecaoEntrada"
            [required]="true"
            [formControlName]="formControls.idPessoa"
            placeholder="NaoConformidades.NaoConformidadesEditor.Fornecedor"
            personType="SupplierAndShippingCompany"
            (changedEvent)="pessoaAlterada($event)"
            class="w-1/4"
          ></person-person-autocomplete-single>

          <vs-input
            [required]="origem === origemNaoConformidadesEnum.InspecaoSaida"
            [formControlName]="formControls.numeroOdf"
            type="number"
            placeholder="NaoConformidades.NaoConformidadesEditor.Odf"
            (blurEvent)="odfPreenchido()"
            class="w-1/4"
          ></vs-input>

          <qa-produto-autocomplete-select
            [formControlName]="formControls.idProduto"
            [required]="true"
            placeholder="NaoConformidades.NaoConformidadesEditor.Produto"
            class="w-1/4"
          ></qa-produto-autocomplete-select>

          <vs-input
            [formControlName]="formControls.numeroLote"
            type="string"
            placeholder="NaoConformidades.NaoConformidadesEditor.Lote"
            class="w-1/4"
          ></vs-input>
        </div>

        <div class="field-container w-1/1">
          <vs-datepicker
            [controlName]="formControls.dataFabricacaoLote"
            placeholder="NaoConformidades.NaoConformidadesEditor.DataFabricacao"
            class="w-1/4"
          ></vs-datepicker>
          <vs-input
            [formControlName]="formControls.campoNf"
            placeholder="NaoConformidades.NaoConformidadesEditor.CampoNf"
            class="w-1/4"
          ></vs-input>
          <admin-user-autocomplete-select
            [formControlName]="formControls.idCriador"
            placeholder="NaoConformidades.NaoConformidadesEditor.Usuario"
            class="w-1/4"
          ></admin-user-autocomplete-select>
          <vs-input
            [formControlName]="formControls.revisao"
            type="number"
            placeholder="NaoConformidades.NaoConformidadesEditor.Revisao"
            class="w-1/4"
          ></vs-input>
        </div>

        <div class="field-container w-1/1">
          <vs-textarea
            [formControlName]="formControls.equipe"
            placeholder="NaoConformidades.NaoConformidadesEditor.Equipe"
            rows="3"
            class="w-1/2"
          ></vs-textarea>
          <vs-textarea
            [formControlName]="formControls.descricao"
            rows="3"
            placeholder="NaoConformidades.NaoConformidadesEditor.Descricao"
            class="w-1/2"
          ></vs-textarea>
        </div>

        <div class="field-container w-1/1">
          <vs-checkbox
            [formControlName]="formControls.naoConformidadeEmPotencial"
            label="NaoConformidades.NaoConformidadesEditor.NaoConformidadeEmPotencial"
            class="w-1/4"
          ></vs-checkbox>

          <vs-checkbox
            [formControlName]="formControls.loteTotal"
            label="NaoConformidades.NaoConformidadesEditor.LoteTotal"
            class="w-1/4"
          ></vs-checkbox>

          <vs-checkbox
            [formControlName]="formControls.rejeitado"
            label="NaoConformidades.NaoConformidadesEditor.Rejeitado"
            class="w-1/4"
          ></vs-checkbox>

          <vs-checkbox
            [formControlName]="formControls.retrabalhoNoCliente"
            label="NaoConformidades.NaoConformidadesEditor.RetrabalhoNoCliente"
            class="w-1/4"
          ></vs-checkbox>

        </div>

        <div class="field-container w-1/1">
          <vs-checkbox
            [formControlName]="formControls.relatoNaoConformidade"
            label="NaoConformidades.NaoConformidadesEditor.RelatoNaoConformidade"
            class="w-1/4"
          ></vs-checkbox>

          <vs-checkbox
            [formControlName]="formControls.loteParcial"
            label="NaoConformidades.NaoConformidadesEditor.LoteParcial"
            class="w-1/4"
          ></vs-checkbox>

          <vs-checkbox
            [formControlName]="formControls.aceitoConcessao"
            label="NaoConformidades.NaoConformidadesEditor.AceitoConcessao"
            class="w-1/4"
          ></vs-checkbox>

          <vs-checkbox
            [formControlName]="formControls.retrabalhoPeloCliente"
            label="NaoConformidades.NaoConformidadesEditor.RetrabalhoPeloCliente"
            class="w-1/4"
          ></vs-checkbox>

        </div>

        <div class="field-container w-1/1">
          <vs-checkbox
            [formControlName]="formControls.melhoriaEmPotencial"
            label="NaoConformidades.NaoConformidadesEditor.MelhoriaEmPotencial"
            class="w-1/4"
          ></vs-checkbox>
          <span class="w-1/4"></span>
          <span class="w-1/4"></span>
          <span class="w-1/4"></span>
        </div>
      </form>
    </vs-form>

    <mat-tab-group class="fix-height" (selectedTabChange)="tabChange($event)" *ngIf="isUpdating">
      <mat-tab label="Defeitos">
        <ng-template matTabContent>
          <rnc-defeitos-nao-conformidades
            [idNaoConformidade]="idNaoConformidade"
            (idDefeitoNaoConformidade)="defeitoNaoConformidadeSelecionado($event)"
            class="fix-grid-width"
          ></rnc-defeitos-nao-conformidades>
        </ng-template>
      </mat-tab>
      <mat-tab label="Produtos">
        <ng-template matTabContent>
          <rnc-produtos-nao-conformidades [idNaoConformidade]="idNaoConformidade"></rnc-produtos-nao-conformidades>
        </ng-template>
      </mat-tab>
      <mat-tab label="Serviços">
        <ng-template matTabContent>
          <rnc-servicos-nao-conformidades [idNaoConformidade]="idNaoConformidade"></rnc-servicos-nao-conformidades>
        </ng-template>
      </mat-tab>
      <mat-tab label="Arquivos">
        <ng-template matTabContent>
          <rnc-nao-conformidades-files [idNaoConformidade]="idNaoConformidade"></rnc-nao-conformidades-files>
        </ng-template>
      </mat-tab>
      <mat-tab label="Reclamação">
        <rnc-reclamacoes-nao-conformidades
          [idNaoConformidade]="idNaoConformidade"
          [naoConformidadesForm]="form"
        ></rnc-reclamacoes-nao-conformidades>
      </mat-tab>
      <mat-tab label="Conclusão" *ngIf="!showConcluir">
        <ng-template matTabContent>
          <rnc-conclusao-nao-conformidades [idNaoConformidade]="idNaoConformidade"></rnc-conclusao-nao-conformidades>
        </ng-template>
      </mat-tab>
    </mat-tab-group>
  </div>

  <div footer>
    <vs-button type="save" label="Rnc.Salvar" [disabled]="!canSave()" (clickEvent)="salvarNaoConformidade()"></vs-button>
    <div fxFlex="auto" *ngIf="processando">
      <vs-spinner diameter="25"></vs-spinner>
    </div>
  </div>
</vs-dialog>
